<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="google-adsense-account" content="ca-pub-3650229640310116">
  <title>Community | LearnComputers</title>

  <!-- Same UI styling as index.html (kept inline so this page is standalone) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --bg:#0a0f1f; --accent:#00aaff; --card-bg:rgba(255,255,255,0.08);
      --text:#fff; --glow:0 0 20px rgba(0,170,255,0.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:var(--text);
      background:radial-gradient(circle at top left,#101935,#060a14);overflow-x:hidden;}

    /* ---------------- NAV (identical to index.html) ---------------- */
    nav{
      position:fixed; top:0; left:0; width:100%;
      background:rgba(10,15,30,0.7); backdrop-filter:blur(20px);
      display:flex; justify-content:space-between; align-items:center;
      padding:15px 7%; z-index:1000; box-shadow:0 0 20px rgba(0,0,0,0.5);
    }
    nav .logo{font-size:1.6rem; font-weight:700; color:var(--accent)}
    nav ul{list-style:none; display:flex; gap:25px; margin:0; padding:0}
    nav ul li a{ text-decoration:none; color:#ccc; font-weight:500; transition:0.25s; font-size:1rem}
    nav ul li a:hover, nav ul li a.active{ color:var(--accent) }
    .nav-actions{display:flex; gap:10px; align-items:center}
    .login-btn{
      background:var(--accent); color:#fff; padding:8px 18px; border-radius:12px; font-weight:600; text-decoration:none;
      box-shadow:var(--glow);
    }
    .login-btn:hover{ transform:scale(1.05) }
    #darkModeToggle{ background:none; border:2px solid var(--accent); color:var(--accent); border-radius:10px; padding:6px 10px; cursor:pointer }
    /* ---------------------------------------------------------------- */

    .community {
      padding:140px 10% 80px;
      max-width:1100px;
      margin:0 auto;
    }

    .page-title { text-align:center; color:var(--accent); font-size:2.8rem; margin-bottom:8px; text-shadow:0 0 20px rgba(0,170,255,0.25) }
    .page-sub { text-align:center; color:#b0c4de; margin-bottom:28px; font-size:1.05rem }

    .top-row { display:flex; align-items:center; justify-content:space-between; gap:20px; margin-bottom:18px }
    .left-actions { display:flex; align-items:center; gap:12px }

    /* + button */
    #addPostBtn {
      width:56px; height:56px; border-radius:50%; border:none; background:var(--accent); color:white; font-size:28px;
      display:inline-flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:var(--glow);
    }
    #addPostBtn.frozen { opacity:.45; cursor:not-allowed; box-shadow:none; }

    .login-warning { color:#ff7a7a; font-size:0.95rem; display:none; }

    /* Filter */
    .filter-wrap { margin-left:auto; display:flex; align-items:center; gap:12px }
    select#topicFilter {
      appearance: none; -webkit-appearance:none; -moz-appearance:none;
      padding:10px 16px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);
      background:rgb(231, 222, 222); color: #fff; font-weight:600; cursor:pointer;
    }
    /* when user has chosen (not "All"), make it bold black style */
    select#topicFilter.filtered { background:#fff; color:#000; font-weight:800; }

    /* Posts stack vertically, newest first */
    #postsContainer{ margin-top:18px; display:flex; flex-direction:column; gap:18px }

    .post-card{
      background:var(--card-bg); backdrop-filter:blur(14px); border-radius:14px; padding:20px;
      box-shadow:var(--glow); cursor:pointer; transition:transform .18s ease, box-shadow .18s ease;
      text-align:left;
    }
    .post-card:hover { transform:translateY(-6px); box-shadow:0 0 32px rgba(0,170,255,0.45) }
    .post-meta { display:flex; gap:12px; align-items:center; font-size:0.85rem; color:#b8cfe9; margin-bottom:8px }
    .post-date { color:#9fb7da; font-size:0.8rem }
    .post-topic { background:rgba(255,255,255,0.03); padding:4px 8px; border-radius:8px; color:#cfeaff; font-weight:700; font-size:0.82rem }

    .post-title { color:var(--accent); font-size:1.12rem; margin:6px 0 10px; font-weight:700 }
    .post-body { color:#dbeaff; line-height:1.5; font-size:0.98rem }

    /* Modal full-screen white UI for opened post */
    .post-modal {
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.75); z-index:2200;
    }
    .post-modal .card {
      width:90%; max-width:900px; max-height:88vh; overflow:auto; background:#fff; color:#000; border-radius:12px; padding:24px;
      box-shadow:0 20px 60px rgba(0,0,0,0.6);
    }
    .modal-close { float:right; cursor:pointer; font-size:20px; color:#888 }
    .modal-title { color:#0a63a8; font-size:1.4rem; margin:6px 0 4px; font-weight:700 }
    .modal-meta { color:#666; font-size:0.9rem; margin-bottom:16px }
    .modal-body { color:#222; line-height:1.6 }

    .replies { margin-top:18px; border-top:1px solid #eee; padding-top:14px }
    .reply { background:#f6f9ff; padding:10px 12px; border-radius:10px; margin-top:10px; color:#0b2240 }
    .reply-author { font-weight:700; color:#0a63a8; margin-bottom:6px }
    .reply-text { color:#0b2240; }

    .reply-area { margin-top:12px; display:flex; flex-direction:column; gap:10px }
    .reply-area textarea { min-height:80px; padding:10px; border-radius:8px; border:1px solid #ddd; resize:vertical; font-size:1rem; }
    .reply-area button { align-self:flex-end; background:var(--accent); color:white; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:700 }
    .reply-area button:disabled { opacity:.5; cursor:not-allowed }

    footer{ text-align:center; padding:25px; background:rgba(10,15,25,0.8); backdrop-filter:blur(10px); color:#aaa; margin-top:40px }

    /* responsive */
    @media (max-width:700px){
      .post-meta{flex-direction:column;align-items:flex-start; gap:6px}
      .reply-area button{width:100%}
      .modal-body{font-size:0.95rem}
    }
  </style>
</head>
<body>

  <!-- NAVBAR (unchanged) -->
  <nav>
    <div class="logo">ðŸ’» Learn<span style="color:#fff;">Computers</span></div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="learning.html">Learn</a></li>
      <li><a href="community.html" class="active">Community</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="stories.html">Stories</a></li>
      <li><a href="chatbot.html">AI Chat</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
    <div class="nav-actions">
      <a href="login.html" class="login-btn">Login</a>
    </div>
  </nav>

  <main class="community">
    <div class="page-title">ðŸ’¬ Community Forum</div>
    <div class="page-sub">Join discussions, ask questions, and learn from others in programming, AI, hardware, and more.</div>

    <div class="top-row">
      <div class="left-actions">
        <button id="addPostBtn">+</button>
        <div id="loginWarning" class="login-warning">You must be logged in to create a post.</div>
      </div>

      <div class="filter-wrap">
        <label for="topicFilter" style="color:#f0f2f5;font-weight:600;margin-right:8px">Filter:</label>
        <select id="topicFilter" style="color:#0c0c0c" aria-label="Filter posts by topic">
          <option value="All" selected>All</option>
          <option>Programming & Coding</option>
          <option>AI & Machine Learning</option>
          <option>Cybersecurity & Hacking</option>
          <option>Computer Hardware</option>
          <option>Web Development</option>
          <option>Networking</option>
          <option>Operating Systems</option>
          <option>Databases</option>
          <option>Cloud Computing</option>
          <option>DevOps</option>
          <option>PC Troubleshooting</option>
          <option>Software Engineering</option>
          <option>Robotics</option>
          <option>Data Science</option>
          <option>App Development</option>
          <option>Internet of Things (IoT)</option>
          <option>AI Ethics</option>
          <option>Math for Computing</option>
          <option>History of Computers</option>
          <option>Career & Certifications</option>
          <option>Other</option>
        </select>
      </div>
    </div>

    <div id="postsContainer" aria-live="polite"></div>
  </main>

  <!-- Full-screen white modal for opened post -->
  <div id="postModal" class="post-modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="card" role="document">
      <span id="closeModal" class="modal-close">âœ•</span>
      <div id="modalContent">
        <div class="modal-title" id="modalTitle"></div>
        <div class="modal-meta" id="modalMeta"></div>
        <div class="modal-body" id="modalBody"></div>

        <div class="replies" id="modalReplies">
          <h4>Replies</h4>
          <div id="repliesList"></div>

          <div id="replyArea" class="reply-area">
            <textarea id="replyText" placeholder="Write a reply..."></textarea>
            <button id="replySendBtn">Reply</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>Â© 2025 LearnComputers. All rights reserved.</footer>

  <script type="module">
/* ================= FIREBASE IMPORTS ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs, query,
  orderBy, where, serverTimestamp, doc, setDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import {
  getAuth, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* ================= FIREBASE CONFIG ================= */
const knownFirebaseConfig = {
  apiKey: "AIzaSyBGsPfMlXGVMLazt4UahGyVzW2b1H1RyLA",
  authDomain: "learncomputers-f88f1.firebaseapp.com",
  projectId: "learncomputers-f88f1",
  storageBucket: "learncomputers-f88f1.firebasestorage.app",
  messagingSenderId: "5443256661",
  appId: "1:5443256661:web:a2230e7ee2c99749866fdc",
  measurementId: "G-XRFCTMV5FJ"
};

const app = initializeApp(knownFirebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* ================= LOGIN STATE ================= */
let currentUser = null;

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
    localStorage.setItem("loggedIn", "true");
    localStorage.setItem("username", user.displayName || "@User");
  } else {
    currentUser = null;
    localStorage.setItem("loggedIn", "false");
  }
});

/* ================= ELEMENTS ================= */
const addPostBtn = document.getElementById('addPostBtn');
const loginWarning = document.getElementById('loginWarning');
const topicFilter = document.getElementById('topicFilter');
const postsContainer = document.getElementById('postsContainer');

const postModal = document.getElementById('postModal');
const closeModal = document.getElementById('closeModal');
const modalTitle = document.getElementById('modalTitle');
const modalMeta = document.getElementById('modalMeta');
const modalBody = document.getElementById('modalBody');
const repliesList = document.getElementById('repliesList');
const replyArea = document.getElementById('replyArea');
const replyText = document.getElementById('replyText');
const replySendBtn = document.getElementById('replySendBtn');

let currentOpenPostId = null;

/* ================= HELPERS ================= */
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, m =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
  );
}
function truncate(s,n){ return s.length>n ? s.slice(0,n-1)+'â€¦' : s }

/* ================= ADD POST UI STATE ================= */
function updateAddPostUI(){
  if(!currentUser){
    addPostBtn.classList.add('frozen');
    loginWarning.style.display='block';
  }else{
    addPostBtn.classList.remove('frozen');
    loginWarning.style.display='none';
  }
}
setInterval(updateAddPostUI, 500);

/* ================= LOAD POSTS ================= */
async function loadPosts(){
  postsContainer.innerHTML='';
  const q = query(collection(db,"posts"), orderBy("createdAt","desc"));
  const snap = await getDocs(q);

  snap.forEach(docSnap=>{
    const p = docSnap.data();
    if(topicFilter.value!=="All" && p.topic!==topicFilter.value) return;

    const el = document.createElement("article");
    el.className="post-card";
    el.innerHTML=`
      <div class="post-meta">
        <div class="post-date">ðŸ“… ${p.createdAt?.toDate().toLocaleString()}</div>
        <div class="post-topic">${p.topic}</div>
      </div>
      <div style="color:#bfe6ff;margin-bottom:6px">${p.author}</div>
      <div class="post-title">${escapeHtml(p.title)}</div>
      <div class="post-body">${escapeHtml(truncate(p.text,280))}</div>
    `;
    el.onclick=()=>openPost(docSnap.id,p);
    postsContainer.appendChild(el);
  });
}
loadPosts();

/* ================= OPEN POST ================= */
async function openPost(id,p){
  currentOpenPostId=id;
  modalTitle.textContent=p.title;
  modalMeta.textContent=`By ${p.author} â€¢ ${p.topic}`;
  modalBody.textContent=p.text;
  repliesList.innerHTML='';

  const rq=query(collection(db,"posts",id,"replies"),orderBy("createdAt","asc"));
  const rs=await getDocs(rq);

  if(rs.empty) repliesList.innerHTML="<p style='color:#666'>No replies yet.</p>";

  rs.forEach(r=>{
    const d=r.data();
    const div=document.createElement("div");
    div.className="reply";
    div.innerHTML=`
      <div class="reply-author">${d.author}</div>
      <div class="reply-text">${escapeHtml(d.text)}</div>
      <div style="font-size:.8rem;color:#777">${d.createdAt?.toDate().toLocaleString()}</div>
    `;
    repliesList.appendChild(div);
  });

  replyArea.style.display=currentUser?"block":"none";
  postModal.style.display="flex";
}

/* ================= CREATE POST ================= */
addPostBtn.onclick=async()=>{
  if(!currentUser){
    Swal.fire({icon:'warning',title:'Login required'});
    return;
  }

  const {value:v}=await Swal.fire({
    title:'Create a new post',
    html:
      `<input id="t" class="swal2-input" placeholder="Heading">`+
      `<select id="tp" class="swal2-select">${[...topicFilter.options].map(o=>`<option>${o.text}</option>`).join('')}</select>`+
      `<textarea id="c" class="swal2-textarea" placeholder="Write your post"></textarea>`,
    showCancelButton:true,
    preConfirm:()=>{
      const t=document.getElementById('t').value.trim();
      const c=document.getElementById('c').value.trim();
      if(!t||!c) return Swal.showValidationMessage("All fields required");
      return {t,c,tp:document.getElementById('tp').value};
    }
  });

  if(v){
    await addDoc(collection(db,"posts"),{
      title:v.t,
      text:v.c,
      topic:v.tp,
      author:localStorage.getItem("username"),
      authorUid:currentUser.uid,
      createdAt:serverTimestamp(),
      likeCount:0
    });
    loadPosts();
    Swal.fire({icon:'success',title:'Posted',timer:1200,showConfirmButton:false});
  }
};

/* ================= REPLY ================= */
replySendBtn.onclick=async()=>{
  if(!currentUser) return;
  const txt=replyText.value.trim();
  if(!txt) return;

  await addDoc(collection(db,"posts",currentOpenPostId,"replies"),{
    text:txt,
    author:localStorage.getItem("username"),
    authorUid:currentUser.uid,
    createdAt:serverTimestamp()
  });

  replyText.value='';
  openPost(currentOpenPostId,{title:modalTitle.textContent,text:modalBody.textContent,topic:""});
};

/* ================= FILTER ================= */
topicFilter.onchange=()=>loadPosts();

/* ================= MODAL CLOSE ================= */
closeModal.onclick=()=>postModal.style.display="none";
postModal.onclick=e=>{ if(e.target===postModal) postModal.style.display="none"; };

</script>

</body>
</html>
